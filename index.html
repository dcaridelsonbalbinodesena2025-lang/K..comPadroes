<meta name='viewport' content='width=device-width, initial-scale=1'/><!DOCTYPE html>
<html lang="pt-pt">
<head>
    <meta charset="UTF-8">
    <meta name='viewport' content='width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no'/>
    <title>K.C.M ULTIMATE - BRAIN PRO</title>
    <style>
        :root { --bg: #06090c; --green: #00ff88; --red: #ff3355; --panel: #11151c; --blue: #00a2ff; --yellow: #ffcc00; }
        body { margin: 0; background: var(--bg); color: #fff; font-family: 'Segoe UI', sans-serif; overflow: hidden; touch-action: none; }
        .ui { position: absolute; z-index: 1000; width: 100%; pointer-events: none; }
        .interactive { pointer-events: auto; }
        
        #finance-panel {
            position: absolute; bottom: 65px; left: 20px;
            background: rgba(17, 21, 28, 0.95); padding: 12px;
            border-radius: 8px; border: 1px solid var(--blue);
            font-size: 13px; z-index: 1000; pointer-events: auto;
            display: flex; flex-direction: column; gap: 6px; min-width: 180px;
        }
        .fin-item { display: flex; justify-content: space-between; cursor: pointer; border-bottom: 1px solid #2d3648; padding: 4px 0; }
        .fin-value { color: var(--green); font-weight: bold; margin-left: 15px; }

        .watermark { position: absolute; bottom: 20px; left: 20px; font-size: 18px; font-weight: bold; color: var(--blue); text-shadow: 0 0 10px #fff, 0 0 20px var(--blue); z-index: 500; pointer-events: none; border: 1px solid rgba(255,255,255,0.3); padding: 5px 10px; border-radius: 5px; background: rgba(0,0,0,0.3); }
        .asset-btn { position: absolute; top: 15px; left: 15px; background: var(--panel); padding: 12px 18px; border-radius: 8px; border: 1px solid #2d3648; cursor: pointer; display: flex; align-items: center; gap: 10px; font-weight: bold; width: 240px; box-sizing: border-box; }
        .asset-menu { display: none; position: absolute; top: 70px; left: 15px; background: var(--panel); border: 1px solid #2d3648; border-radius: 8px; width: 280px; max-height: 70vh; overflow-y: auto; z-index: 1001; }
        .asset-menu.open { display: block; }
        .item { padding: 12px 15px; cursor: pointer; border-bottom: 1px solid #1c232e; font-size: 13px; }
        .item:hover { background: #1c232e; color: var(--blue); }
        
        #timer-box { position: absolute; right: 15px; top: 15px; background: rgba(17, 21, 28, 0.95); padding: 10px 20px; border-radius: 8px; border: 2px solid var(--blue); text-align: center; }
        #timer { font-size: 22px; font-weight: bold; font-family: monospace; display: block; }
        
        /* NOVO CRONOMETRO ESTILO */
        #stopwatch-box { position: absolute; right: 145px; top: 15px; background: rgba(17, 21, 28, 0.95); padding: 10px 20px; border-radius: 8px; border: 2px solid var(--green); text-align: center; cursor: pointer; user-select: none; }
        #stopwatch { font-size: 22px; font-weight: bold; font-family: monospace; display: block; color: var(--green); }

        #placar { position: absolute; top: 115px; left: 15px; background: rgba(17,21,28,0.85); padding: 10px; border-radius: 8px; font-size: 13px; border: 1px solid #333; display: flex; gap: 15px; }
        #trend-info { position: absolute; top: 75px; left: 15px; background: rgba(17, 21, 28, 0.8); padding: 6px 12px; border-radius: 6px; font-size: 11px; font-weight: bold; width: 240px; border-left: 4px solid var(--blue); }
        
        #signal-alert { position: absolute; top: 40%; left: 50%; transform: translate(-50%, -50%); font-size: 55px; font-weight: bold; text-shadow: 0 0 20px #000; z-index: 2000; pointer-events: none; display: none; text-align: center; }

        #price-tag { position: absolute; right: 0; padding: 6px 12px; font-family: monospace; font-weight: bold; font-size: 16px; border-radius: 6px 0 0 6px; z-index: 100; color: #000; pointer-events: none; }
        canvas { display: block; width: 100vw; height: 100vh; }
    </style>
</head>
<body>

<div id="signal-alert"></div>

<div id="finance-panel">
    <div class="fin-item" ondblclick="editFinance('banca')">BANCA: <span class="fin-value" id="val-banca">R$ 1000.00</span></div>
    <div class="fin-item" ondblclick="editFinance('payout')">PAYOUT: <span class="fin-value" id="val-payout">85%</span></div>
    <div class="fin-item" ondblclick="editFinance('percent')">ENTRADA: <span class="fin-value" id="val-percent">1%</span></div>
</div>

<div class="watermark">K.COM BRAIN„ÄΩÔ∏è(Aridelson B.)</div>

<div class="ui">
    <div class="asset-btn interactive" onclick="toggleMenu()">
        <span id="asset-display">üìä Volatility 100</span> <small>‚ñº</small>
    </div>
    <div class="asset-menu interactive" id="menu"></div>
    <div id="trend-info" class="interactive">ANALISANDO MERCADO...</div>
    
    <div id="stopwatch-box" class="interactive" onclick="toggleStopwatch()" ondblclick="resetStopwatch()">
        <span style="font-size:9px">CRON√îMETRO</span><b id="stopwatch">00:00</b>
    </div>

    <div id="timer-box"><span style="font-size:9px">VELA EM</span><b id="timer">00:00</b></div>
    <div id="placar" class="interactive">
        <div style="color:var(--green)">WIN: <b id="win-c">0</b></div>
        <div style="color:var(--red)">LOSS: <b id="loss-c">0</b></div>
        <div id="gale-txt" style="color:var(--blue); font-weight: bold;">AGUARDANDO PADR√ÉO</div>
    </div>
</div>

<canvas id="chartCanvas"></canvas>
<div id="price-tag">0.0000</div>

<script>
    const canvas = document.getElementById('chartCanvas');
    const ctx = canvas.getContext('2d');
    const priceTag = document.getElementById('price-tag');
    const timerTxt = document.getElementById('timer');
    const trendDisplay = document.getElementById('trend-info');
    const signalAlert = document.getElementById('signal-alert');

    // VARIAVEIS DO CRONOMETRO NOVO
    const stopwatchTxt = document.getElementById('stopwatch');
    let swTime = 0, swInterval = null, swRunning = false;

    function toggleStopwatch() {
        if(swRunning) { clearInterval(swInterval); swRunning = false; stopwatchTxt.style.color = 'var(--yellow)'; }
        else {
            swRunning = true; stopwatchTxt.style.color = 'var(--green)';
            swInterval = setInterval(() => {
                swTime++;
                let m = Math.floor(swTime/60).toString().padStart(2,'0');
                let s = (swTime%60).toString().padStart(2,'0');
                stopwatchTxt.innerText = `${m}:${s}`;
            }, 1000);
        }
    }
    function resetStopwatch() {
        clearInterval(swInterval); swTime = 0; swRunning = false;
        stopwatchTxt.innerText = "00:00"; stopwatchTxt.style.color = 'var(--green)';
    }

    let bancaAtual = 1000.00, payoutAtivo = 85, percentualUso = 1, valorApostaAtual = 0;
    let wins = 0, losses = 0, emGale = 0, sinalPendente = null, operacaoAtiva = null;
    let history = [], current = null, lastPrice = 0, socket = null;
    
    let spacing = 20, dragX = 0, dragY = 0, zoomY = 1.9;
    let lastX, lastY, isDragging = false, lastDist = 0;
    let resistances = [], supports = [], lastMinute = -1;
    let zigzagPoints = [], fractals = [], lta = null, ltb = null;
    let pulseOpacity = 1, pulseDir = -0.05;

    function analyzeCandlePatterns(list, idx) {
        if(list.length < 5 || idx < 1) return null;
        const last = list[idx];
        const prev = list[idx - 1];
        const body = Math.abs(last.close - last.open);
        const upperWick = last.high - Math.max(last.open, last.close);
        const lowerWick = Math.min(last.open, last.close) - last.low;
        const fullSize = last.high - last.low;

        const isLow = last.low <= Math.min(prev.low, list[idx-2]?.low || 999999);
        const isHigh = last.high >= Math.max(prev.high, list[idx-2]?.high || 0);

        if (lowerWick > body * 2 && upperWick < body * 0.5 && isLow) return { name: "MARTELO", dir: "CALL" };
        if (upperWick > body * 2 && lowerWick < body * 0.5 && isLow) return { name: "MARTELO INV.", dir: "CALL" };
        if (last.close > last.open && prev.open > prev.close && last.close > prev.open) return { name: "ENGOLFO ALTA", dir: "CALL" };
        if (last.close > last.open && prev.open > prev.close && last.close > (prev.open + prev.close)/2 && last.open < prev.close) return { name: "PIERCING", dir: "CALL" };
        if (body > fullSize * 0.8 && last.close > last.open) return { name: "FOR√áA ALTA", dir: "CALL" };

        if (lowerWick > body * 2 && upperWick < body * 0.5 && isHigh) return { name: "ENFORCADO", dir: "PUT" };
        if (upperWick > body * 2 && lowerWick < body * 0.5 && isHigh) return { name: "ESTRELA", dir: "PUT" };
        if (last.open > last.close && prev.close > prev.open && last.close < prev.open) return { name: "ENGOLFO BAIXA", dir: "PUT" };
        if (last.open > last.close && prev.close > prev.open && last.close < (prev.open + prev.close)/2 && last.open > prev.close) return { name: "NUVEM NEGRA", dir: "PUT" };
        if (body > fullSize * 0.8 && last.close < last.open) return { name: "FOR√áA BAIXA", dir: "PUT" };

        if (body < (fullSize * 0.1)) return { name: "DOJI", dir: null };
        return null;
    }

    function showScreenMsg(txt, color) {
        signalAlert.innerText = txt;
        signalAlert.style.color = color;
        signalAlert.style.display = 'block';
        setTimeout(() => { signalAlert.style.display = 'none'; }, 4000);
    }

    function detectTrend() {
        if(history.length < 20) return "EST√ÅVEL";
        const sum = history.slice(-10).reduce((a, b) => a + (b.close > b.open ? 1 : -1), 0);
        if(sum > 2) return "TEND√äNCIA: ALTA üìà";
        if(sum < -2) return "TEND√äNCIA: BAIXA üìâ";
        return "MERCADO LATERALIZADO";
    }

    function updateFinanceUI() {
        document.getElementById('val-banca').innerText = `R$ ${bancaAtual.toFixed(2)}`;
        document.getElementById('val-payout').innerText = `${payoutAtivo}%`;
        document.getElementById('val-percent').innerText = `${percentualUso}%`;
    }

    function editFinance(tipo) {
        let n = prompt(`Novo valor para ${tipo}:`);
        if(n) {
            if(tipo==='banca') bancaAtual = parseFloat(n);
            if(tipo==='payout') payoutAtivo = parseFloat(n);
            if(tipo==='percent') percentualUso = parseFloat(n);
            updateFinanceUI();
        }
    }

    function calculateIndicators() {
        if(history.length < 10) return;
        const all = [...history, current];
        fractals = [];
        for(let i = 2; i < all.length - 2; i++) {
            if(all[i].high > all[i-1].high && all[i].high > all[i-2].high && all[i].high > all[i+1].high && all[i].high > all[i+2].high) {
                fractals.push({ index: i, type: 'top', price: all[i].high });
            }
            if(all[i].low < all[i-1].low && all[i].low < all[i-2].low && all[i].low < all[i+1].low && all[i].low < all[i+2].low) {
                fractals.push({ index: i, type: 'bottom', price: all[i].low });
            }
        }
        zigzagPoints = [];
        let lastType = null;
        fractals.forEach(f => {
            if(f.type !== lastType) { zigzagPoints.push(f); lastType = f.type; }
            else {
                let last = zigzagPoints[zigzagPoints.length-1];
                if(f.type === 'top' && f.price > last.price) zigzagPoints[zigzagPoints.length-1] = f;
                if(f.type === 'bottom' && f.price < last.price) zigzagPoints[zigzagPoints.length-1] = f;
            }
        });
        const tops = zigzagPoints.filter(p => p.type === 'top');
        const bottoms = zigzagPoints.filter(p => p.type === 'bottom');
        if(tops.length >= 2) ltb = { p1: tops[tops.length-2], p2: tops[tops.length-1] };
        if(bottoms.length >= 2) lta = { p1: bottoms[bottoms.length-2], p2: bottoms[bottoms.length-1] };
    }

    const LISTA_COMPLETA = [
        { id: "NONE", nome: "‚ùå DESATIVAR SLOT" }, { id: "1HZ10V", nome: "üìà Volatility 10 (1s)" }, { id: "1HZ25V", nome: "üìà Volatility 25 (1s)" }, { id: "1HZ50V", nome: "üìà Volatility 50 (1s)" }, { id: "1HZ75V", nome: "üìà Volatility 75 (1s)" }, { id: "1HZ100V", nome: "üìà Volatility 100 (1s)" }, { id: "R_10", nome: "üìä Volatility 10" }, { id: "R_25", nome: "üìä Volatility 25" }, { id: "R_50", nome: "üìä Volatility 50" }, { id: "R_75", nome: "üìä Volatility 75" }, { id: "R_100", nome: "üìä Volatility 100" }, { id: "JD10", nome: "üöÄ Jump 10" }, { id: "JD25", nome: "üöÄ Jump 25" }, { id: "JD50", nome: "üöÄ Jump 50" }, { id: "JD75", nome: "üöÄ Jump 75" }, { id: "JD100", nome: "üöÄ Jump 100" }, { id: "BOOM300", nome: "üí• Boom 300" }, { id: "BOOM500", nome: "üí• Boom 500" }, { id: "BOOM1000", nome: "üí• Boom 1000" }, { id: "CRASH300", nome: "üìâ Crash 300" }, { id: "CRASH500", nome: "üìâ Crash 500" }, { id: "CRASH1000", nome: "üìâ Crash 1000" }, { id: "ST50", nome: "üé¢ Step Index" }, { id: "frxEURUSD", nome: "üí± EUR/USD" }, { id: "frxGBPUSD", nome: "üí± GBP/USD" }, { id: "frxUSDJPY", nome: "üí± USD/JPY" }, { id: "frxAUDUSD", nome: "üí± AUD/USD" }, { id: "frxUSDCAD", nome: "üí± USD/CAD" }, { id: "frxUSDCHF", nome: "üí± USD/CHF" }, { id: "frxEURGBP", nome: "üí± EUR/GBP" }, { id: "frxEURJPY", nome: "üí± EUR/JPY" }, { id: "frxGBPJPY", nome: "üí± GBP/JPY" }, { id: "frxXAUUSD", nome: "ü™ô OURO (XAU)" }, { id: "frxXAGUSD", nome: "ü•à PRATA (XAG)" }, { id: "cryBTCUSD", nome: "‚Çø BITCOIN" }, { id: "cryETHUSD", nome: "‚ô¢ ETHEREUM" }
    ];

    const menu = document.getElementById('menu');
    LISTA_COMPLETA.forEach(ativo => {
        const div = document.createElement('div');
        div.className = 'item'; div.innerHTML = ativo.nome;
        div.onclick = () => sel(ativo.id, ativo.nome);
        menu.appendChild(div);
    });

    function toggleMenu() { menu.classList.toggle('open'); }
    function sel(id, nome) { 
        document.getElementById('asset-display').innerText = nome;
        history = []; current = null; zigzagPoints = []; toggleMenu();
        if(id !== "NONE") connect(id);
    }

    function updateAnalisis() {
        if (history.length < 20) return;
        const recent = history.slice(-40);
        let topos = [], fundos = [];
        for(let i=2; i<recent.length-2; i++) {
            if(recent[i].high > recent[i-1].high && recent[i].high > recent[i+1].high) topos.push(recent[i].high);
            if(recent[i].low < recent[i-1].low && recent[i].low < recent[i+1].low) fundos.push(recent[i].low);
        }
        resistances = [...new Set(topos)].sort((a,b) => b-a).slice(0, 3);
        supports = [...new Set(fundos)].sort((a,b) => a-b).slice(0, 3);
        calculateIndicators();
        trendDisplay.innerText = detectTrend() + " | STATUS: " + (history.length > 30 ? "OTIMO" : "AGUARDE");
    }

    function connect(symbol) {
        if(socket) socket.close();
        socket = new WebSocket('wss://ws.binaryws.com/websockets/v3?app_id=1089');
        socket.onopen = () => { socket.send(JSON.stringify({ ticks_history: symbol, end: "latest", count: 100, style: "candles", granularity: 60, subscribe: 1 })); };
        socket.onmessage = (msg) => {
            const data = JSON.parse(msg.data);
            if(data.candles) { history = data.candles; current = history.pop(); updateAnalisis(); }
            if(data.ohlc) {
                lastPrice = parseFloat(data.ohlc.close);
                const now = new Date(); const sec = now.getSeconds();
                if (lastMinute !== -1 && now.getMinutes() !== lastMinute) {
                    if (operacaoAtiva) validarResultado(current);
                    
                    if (sinalPendente) {
                        valorApostaAtual = emGale === 0 ? (bancaAtual * (percentualUso / 100)) : valorApostaAtual * 2;
                        bancaAtual -= valorApostaAtual; updateFinanceUI();
                        operacaoAtiva = { dir: sinalPendente.dir, precoEntrada: lastPrice, valorRiscado: valorApostaAtual };
                        sinalPendente = null; signalAlert.style.display = 'none';
                    }

                    if (current && !operacaoAtiva && emGale === 0) {
                        history.push({...current});
                        const pattern = analyzeCandlePatterns(history, history.length - 1);
                        if(pattern && pattern.dir) {
                            sinalPendente = { dir: pattern.dir, name: pattern.name };
                            document.getElementById('gale-txt').innerText = "GATILHO: " + pattern.name;
                            showScreenMsg(pattern.dir + "!", pattern.dir === "CALL" ? "var(--green)" : "var(--red)");
                        } else {
                            document.getElementById('gale-txt').innerText = "AGUARDANDO PADR√ÉO";
                        }
                    } else if (current) {
                        history.push({...current});
                    }
                    
                    current = { time: data.ohlc.open_time, open: lastPrice, high: lastPrice, low: lastPrice, close: lastPrice };
                    updateAnalisis();
                } else if(current) { current.close = lastPrice; current.high = Math.max(current.high, lastPrice); current.low = Math.min(current.low, lastPrice); }
                lastMinute = now.getMinutes();
                timerTxt.innerText = `00:${(60 - sec).toString().padStart(2, '0')}`;
            }
        };
    }

    function validarResultado(v) {
        const win = (operacaoAtiva.dir === 'CALL' && v.close > operacaoAtiva.precoEntrada) || (operacaoAtiva.dir === 'PUT' && v.close < operacaoAtiva.precoEntrada);
        if(win) { 
            wins++; 
            bancaAtual += (operacaoAtiva.valorRiscado + (operacaoAtiva.valorRiscado * (payoutAtivo/100))); 
            showScreenMsg("GREEN!", "var(--green)");
            emGale = 0; 
            document.getElementById('gale-txt').innerText = "WIN! üöÄ";
        }
        else if(emGale < 2) { 
            emGale++; 
            sinalPendente = { dir: operacaoAtiva.dir, name: "GALE " + emGale }; 
            showScreenMsg("GALE " + emGale, "var(--yellow)");
            document.getElementById('gale-txt').innerText = "GALE " + emGale;
        }
        else { 
            losses++; 
            emGale = 0; 
            showScreenMsg("RED / LOSS", "var(--red)");
            document.getElementById('gale-txt').innerText = "LOSS ‚ùå";
        }
        operacaoAtiva = null; updateFinanceUI();
        document.getElementById('win-c').innerText = wins; document.getElementById('loss-c').innerText = losses;
    }

    function draw() {
        canvas.width = window.innerWidth; canvas.height = window.innerHeight;
        if(!current) { requestAnimationFrame(draw); return; }
        pulseOpacity += pulseDir;
        if(pulseOpacity <= 0.3 || pulseOpacity >= 1) pulseDir *= -1;
        const all = [...history, current];
        const prices = all.flatMap(c => [c.high, c.low]);
        const maxP = Math.max(...prices), minP = Math.min(...prices), range = (maxP - minP) || 0.0001;
        const scaleY = (canvas.height * 0.7 / range) * zoomY, centerY = canvas.height / 2 + dragY, midP = (maxP + minP) / 2, offX = (canvas.width - 150) - (all.length * spacing) + dragX;

        resistances.forEach(r => { ctx.setLineDash([5, 5]); ctx.strokeStyle = "rgba(255, 51, 85, 0.4)"; ctx.beginPath(); ctx.moveTo(0, centerY + (midP - r) * scaleY); ctx.lineTo(canvas.width, centerY + (midP - r) * scaleY); ctx.stroke(); });
        supports.forEach(s => { ctx.setLineDash([5, 5]); ctx.strokeStyle = "rgba(0, 255, 136, 0.4)"; ctx.beginPath(); ctx.moveTo(0, centerY + (midP - s) * scaleY); ctx.lineTo(canvas.width, centerY + (midP - s) * scaleY); ctx.stroke(); });

        ctx.setLineDash([]); ctx.lineWidth = 1;
        if(lta) { ctx.strokeStyle = "rgba(0, 255, 136, 0.6)"; ctx.beginPath(); ctx.moveTo(offX + lta.p1.index * spacing, centerY + (midP - lta.p1.price) * scaleY); ctx.lineTo(canvas.width, centerY + (midP - lta.p2.price) * scaleY); ctx.stroke(); }
        if(ltb) { ctx.strokeStyle = "rgba(255, 51, 85, 0.6)"; ctx.beginPath(); ctx.moveTo(offX + ltb.p1.index * spacing, centerY + (midP - ltb.p1.price) * scaleY); ctx.lineTo(canvas.width, centerY + (midP - ltb.p2.price) * scaleY); ctx.stroke(); }

        all.forEach((c, i) => {
            const x = offX + (i * spacing), yO = centerY + (midP - c.open) * scaleY, yC = centerY + (midP - c.close) * scaleY, yH = centerY + (midP - c.high) * scaleY, yL = centerY + (midP - c.low) * scaleY;
            const isGatilho = (sinalPendente && i === history.length);
            ctx.strokeStyle = c.close >= c.open ? "#00ff88" : "#ff3355";
            if(isGatilho) ctx.globalAlpha = pulseOpacity;
            ctx.beginPath(); ctx.moveTo(x, yH); ctx.lineTo(x, yL); ctx.stroke();
            ctx.fillStyle = ctx.strokeStyle; ctx.fillRect(x - (spacing*0.7)/2, Math.min(yO, yC), spacing*0.7, Math.max(2, Math.abs(yO - yC)));
            if(isGatilho) { ctx.shadowBlur = 15; ctx.shadowColor = ctx.fillStyle; ctx.strokeRect(x - (spacing*0.7)/2, Math.min(yO, yC), spacing*0.7, Math.max(2, Math.abs(yO - yC))); ctx.shadowBlur = 0; }
            ctx.globalAlpha = 1.0;
            const pattern = analyzeCandlePatterns(all, i);
            if(pattern) { ctx.fillStyle = "#ffffff"; ctx.font = "bold 10px Arial"; ctx.textAlign = "center"; const labelY = c.close >= c.open ? yL + 35 : yH - 25; ctx.fillText(pattern.name, x, labelY); }
            const f = fractals.find(fr => fr.index === i);
            if(f) { ctx.fillStyle = f.type === 'top' ? "#ff3355" : "#00ff88"; ctx.font = "bold 16px Arial"; ctx.fillText(f.type === 'top' ? "‚ñº" : "‚ñ≤", x, f.type === 'top' ? yH - 12 : yL + 24); }
        });
        const currentY = centerY + (midP - lastPrice) * scaleY;
        priceTag.style.top = (currentY - 15) + "px";
        priceTag.style.background = lastPrice >= current.open ? "#00ff88" : "#ff3355";
        priceTag.innerText = lastPrice.toFixed(midP > 10 ? 2 : 5);
        requestAnimationFrame(draw);
    }

    canvas.addEventListener('mousedown', e => { isDragging = true; lastX = e.clientX; lastY = e.clientY; });
    window.addEventListener('mousemove', e => { if(isDragging) { dragX += e.clientX - lastX; dragY += e.clientY - lastY; lastX = e.clientX; lastY = e.clientY; } });
    window.addEventListener('mouseup', () => isDragging = false);
    canvas.addEventListener('wheel', e => { e.preventDefault(); const delta = e.deltaY > 0 ? 0.9 : 1.1; spacing = Math.min(Math.max(spacing * delta, 5), 150); zoomY = Math.min(Math.max(zoomY * delta, 0.1), 30); }, { passive: false });

    canvas.addEventListener('touchstart', e => { isDragging = true; if(e.touches.length === 1) { lastX = e.touches[0].clientX; lastY = e.touches[0].clientY; } else if (e.touches.length === 2) { lastDist = Math.hypot(e.touches[0].clientX - e.touches[1].clientX, e.touches[0].clientY - e.touches[1].clientY); } });
    canvas.addEventListener('touchmove', e => { e.preventDefault(); if(e.touches.length === 1 && isDragging) { dragX += e.touches[0].clientX - lastX; dragY += e.touches[0].clientY - lastY; lastX = e.touches[0].clientX; lastY = e.touches[0].clientY; } else if (e.touches.length === 2) { let dist = Math.hypot(e.touches[0].clientX - e.touches[1].clientX, e.touches[0].clientY - e.touches[1].clientY); let delta = dist / lastDist; spacing = Math.min(Math.max(spacing * delta, 5), 400); zoomY = Math.min(Math.max(zoomY * delta, 0.1), 30); lastDist = dist; } }, { passive: false });
    canvas.addEventListener('touchend', () => { isDragging = false; });
    
    connect('R_100'); draw(); updateFinanceUI();
</script>
</body>
</html>
